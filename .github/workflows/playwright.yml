name: End 2 End Test
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
jobs:
  test:
    timeout-minutes: 60
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: lts/*
      - name: Install dependencies
        run: npm install -g pnpm && pnpm install
      - name: start react app locally
        run: npm run start &
      - name: Wait for server to be ready
        run: npx wait-on http://localhost:3000
      - name: Install Playwright Browsers
        run: pnpm exec playwright install --with-deps
      - name: Run Playwright tests
        run: PLAYWRIGHT_JSON_OUTPUT_NAME=results.json pnpm exec playwright test --reporter json
      - name: Playwright report comment
        uses: daun/playwright-report-summary@v3.3.0
        env:
          GITHUB_TOKEN: ${{ secrets.RELEASE_GITHUB_TOKEN }}
        with:
          # Path to the JSON report file generated by Playwright. Required.
          report-file: "results.json"
          # URL to a published html report, uploaded by another action in a previous step.
          # Example pipeline: https://playwright.dev/docs/test-sharding#publishing-report-on-the-web
          report-url: "https://user.github.io/repo/yyyy-mm-dd-id/"
          # A unique tag to represent this report when reporting on multiple test runs
          # Defaults to the current workflow names
          report-tag: ""
          # Title/headline to use for the created pull request comment.
          # Default: Playwright test results
          comment-title: "Results"
          # Create a job summary comment for the workflow run
          # Default: false
          job-summary: true
          # Icon style to use: octicons | emojis
          # Default: octicons
          icon-style: "emojis"
